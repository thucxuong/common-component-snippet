<!DOCTYPE html>
<html>
<head>
    <title>Contact form using Bootstrap 3.3.4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../styles/bootstrap.css">
    <link rel="stylesheet" href="../styles/main.css">
    <style>
      .video-wrapper {
        position: relative;
        padding-top: 56.25%;
      }

      .device .video-wrapper .if-overlay {
        display: none;
      }

      .video-wrapper .if-overlay,
      .video-wrapper iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
      }

      .video-wrapper .if-overlay img,
      .video-wrapper iframe img {
        width: 100%;
      }

      .video-wrapper .play-btn {
        position: absolute;
        top: 50%;
        left: 50%;
        background: red;
        background-size: cover;
        width: 60px;
        height: 60px;
        cursor: pointer;
        transform: translateX(-50%) translateY(-50%);
        border-radius: 50%;
      }

      .device .video-wrapper .play-btn {
        display: none;
      }

    </style>
</head>
<body>
<div class="row">
<div class="col-sm-6 col-sm-offset-3">
  <h1>Instruction</h1>
  <ol>
    <li>Setup Google Developer Account <a href="https://play.google.com/apps/publish/signup/">Here</a></li>
    <li>Create a project in <a href="https://console.developers.google.com/">Google Developer Console</a></li>
    <li>Choose created project in this <a href="https://console.developers.google.com/project/_/apiui/apis/library">link</a></li>
    <li>Select Youtube API and enable it with version 3 checkbox checked</li>
    <li>Access credentials page. Add a credential with "API Key"</li>
    <li>Choose appropriate kind of key you need. Server API Key, Browser API Key, ...</li>
    <li>Name it and add Accepted URL</li>
    <li>Save your credentials</li>
  </ol>
  <div class="video-wrapper">
    <div id="resource-video-player" class="video-player" data-id="HQzu7NYlZNQ"></div>
    <div class="if-overlay"><img src="http://placehold.it/1140x642" alt="video thumbnail"></div>
    <div class="play-btn"></div>
  </div>
  <h1 class="video-time text-center"></h1>
</div>
</div>
</body>
<script type="text/javascript" src="../scripts/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="../scripts/jquery.validate.js"></script>
<script type="text/javascript" src="../scripts/bootstrap.min.js"></script>
<script type="text/javascript">
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
</script>
<script type="text/javascript">
  //Object keys length polyfill for IE8
  Object.keys = Object.keys || function( o, k, r ) {
  r = [];
  for ( k in o ) r.hasOwnProperty.call( o, k ) && r.push( k );
  return r;
};

jQuery( document ).ready( function( $ ) {

  window.ytVideoModule = ( function() {
    var module = {};
    var videosObj = {};
    var videoPlayers;
    var videoState = {
      "-1": "youtubeUnstarted",
      "0": "youtubeEnded",
      "1": "youtubePlaying",
      "2": "youtubePaused",
      "3": "youtubeBuffering",
      "5": "youtubeCued"
    };

    var getYTIframe = function( ytvideoEventObj ) {
      return $( ytvideoEventObj.target.f );
    };

    var ytStateName = function( stateNumber ) {
      return videoState[ stateNumber ];
    };

    var convertYTDurationStrToTimeStr = function( ytDureationStr ) {
      return ytDureationStr.replace( "PT", "" ).replace( "H", ":" ).replace( "M", ":" ).replace( "S", "" );
    };

    var getVideoIdsFromSelector = function( selector, videoidAttributeName ) {
      var videoElements = $( selector );
      videoIDsArr = [],
      videoidAttributeName = videoidAttributeName ? videoidAttributeName : "data-id";

      videoElements.each( function() {
        videoIDsArr.push( $( this ).attr( videoidAttributeName ) );
      } );

      return videoIDsArr;
    };

    var buildVideosDurationObj = function() {
      var videosDuration = {};
      $.each( data.items, function( ind, item ) {
        if ( item.contentDetails ) {
          var timeStr = convertYTDurationStrToTimeStr( item.contentDetails.duration );
          videosDuration[ "v" + item.id ] = timeStr;
        }
      } );

      return videosDuration;
    };


    // Youtube Ajax Requests Callback handlers
    var fireYTReadyEventOnIframe = function( ytvideoEventObj ) {
      getYTIframe( ytvideoEventObj ).trigger( "youtubeReady" );
    };

    var fireYTStateChangeOnIframe = function( ytvideoEventObj ) {

      var curStateName = ytStateName( ytvideoEventObj.data );
      var ytIframe = getYTIframe( ytvideoEventObj );

      if ( curStateName != undefined ) {
        ytIframe.trigger(
        curStateName, [
        ytIframe.attr( "data-id" )
        ]
        );
      }

    };

    // Public methods
    module.init = function() {
      videoPlayers = $( ".video-player" );
      if ( videoPlayers.length === 0 ) {
        return;
      }
      $( videoPlayers ).each( function() {
        var $_this = $( this );
        var videoElData = $_this.data();

        videosObj[ this.id ] = new YT.Player( this.id, {
          height: videoElData.height,
          width: videoElData.width,
          videoId: videoElData.id ? videoElData.id : "",
          events: {
            "onReady": fireYTReadyEventOnIframe,
            "onStateChange": fireYTStateChangeOnIframe
          }
        } );
      } );

      $( document ).trigger( "videoModuleReady" );
      return module;
    };

    module.getVideoById = function( id ) {
      return videosObj[ id ];
    };

    module.videoDurationRetrieve = function( selector, videoidAttributeName, cb ) {

      var videoInfoRetreiveURL = "https://www.googleapis.com/youtube/v3/videos?id=" + getVideoIdsFromSelector( selector, videoidAttributeName ).join( "," ) + "&part=contentDetails&key=AIzaSyCkdDFKttW90ed6SBOYzao3pgvdweeALH4";

      $.getJSON( videoInfoRetreiveURL, function( data ) {
        if ( data.items.length > 1 ) {
          cb( buildVideosDurationObj() );
        } else {
          if ( data.items[ 0 ].contentDetails ) {
            var timeStr = convertYTDurationStrToTimeStr( data.items[ 0 ].contentDetails.duration );
          }
          cb( timeStr );
        }
      } );

      return;
    };

    return module;

  } )();

  window.onYouTubeIframeAPIReady = function() {
    window.ytVideoModule.init();
  };

  $( document ).on( "videoModuleReady", function() {
    
    $( "body" ).on( "click", ".play-btn", function() {
      var overlay = $( this ).parent().find( ".if-overlay" ),
      playBtn = $( this ),
      video = $( this ).parent().find( ".video-player" );
      ytVideoModule.getVideoById( video.get( 0 ).id ).playVideo();
      setTimeout( function() {
        playBtn.fadeOut();
        overlay.fadeOut();
      }, 500 );
    } );

    ytVideoModule.videoDurationRetrieve( "#resource-video-player", "data-id", function( time ) {
      $( ".video-time" ).html( time );
    } );

  } );

} );
</script>
</html>